webpackJsonp([1],{"0WpZ":function(e,t){},"0mzG":function(e,t){},"4NBI":function(e,t){},DKm7:function(e,t){},E5oX:function(e,t){},"M+RY":function(e,t){},"N/eG":function(e,t){},QTQR:function(e,t){},Rdbo:function(e,t){},kioz:function(e,t){},kuto:function(e,t){},lVK7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};n.d(a,"getIndexList",function(){return ee}),n.d(a,"setIndexList",function(){return te}),n.d(a,"clearIndexList",function(){return ne});var r={};n.d(r,"setCurrPage",function(){return ae}),n.d(r,"setScrollPos",function(){return re});var o={};n.d(o,"login",function(){return Ne});var i={};n.d(i,"getUserInfo",function(){return De}),n.d(i,"setUserInfo",function(){return Re});var l={};n.d(l,"getTopicDetail",function(){return je}),n.d(l,"setTopicDetail",function(){return Pe}),n.d(l,"setReplybox",function(){return Fe}),n.d(l,"setClickZan",function(){return We}),n.d(l,"setZan",function(){return Me}),n.d(l,"submitReply",function(){return Ze}),n.d(l,"createTopic",function(){return qe});var c={};n.d(c,"getUserInfo",function(){return Ke}),n.d(c,"setUserInfo",function(){return Qe});var s=n("GiK3"),u=n.n(s),m=n("O27J"),p=n.n(m),d=(n("FvRq"),n("Lwoq")),f=n("F8kA"),h=n("RH2O"),v=n("Y3RN"),g=n.n(v),E=n("PJh5"),y=n.n(E),_=(n("Vz2w"),n("ciQf")),b=n.n(_),k=n("woOf"),N=n.n(k),I=n("Zx67"),x=n.n(I),T=n("Zrlr"),C=n.n(T),w=n("wxAW"),S=n.n(w),D=n("zwoO"),R=n.n(D),O=n("Pf15"),U=n.n(O),L=n("Ol7m"),j="https://cnodejs.org",P="SET_INDEXLIST",F="CLEAR_INDEXLIST",W="SET_DATALOAD",M="SET_LOADFAIL",Z="SET_LOADMSG",q="SET_TOPIC",A="SET_REPLYBOX_DISPLAY",B="SET_ZAN",X="SET_CURRENTPAGE",Y="SET_SCROLL_POSITION",J="SET_USERINFO",H="SET_MESSAGE";function z(e){return{type:W,data:e}}function G(e){return{type:M,data:e}}function K(e){return{type:Z,data:e}}var Q=n("mtWM"),V=n.n(Q),$=function(e,t){var n={method:"get",type:"json",timeout:5e3,url:"",needLoad:!0,data:null,success:null,error:null};for(var a in t)n[a]=t[a];return e(G(!1)),n.needLoad&&e(z(!0)),function(e,t){return V()({method:t.method,responseType:t.type,timeout:t.timeout,data:t.data,url:t.url})}(0,n).then(function(t){return e(z(!1)),200===t.status?t.data.success?(n.success&&n.success(t),t):(e(K("系统繁忙，请稍后再试！")),e(G(!0)),!1):(e(K("请求失败，请稍后再试！")),e(G(!0)),!1)}).catch(function(t){return n.error&&n.error(t),e(K("网络异常，请稍后再试！")),e(G(!0)),e(z(!1)),!1})};function ee(e,t,n){return function(a,r){return $(a,{method:"get",url:j+"/api/v1/topics?tab="+n+"&page="+e+"&limit="+t,data:null,success:function(e){a(te(e.data.data))},error:function(e){alert(e.data.error_msg)}})}}function te(e){return{type:P,data:e}}function ne(){return{type:F}}function ae(e){return{type:X,data:e}}function re(e){return{type:Y,data:e}}n("kuto");var oe=n("KSGD"),ie=n.n(oe),le=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.tab!==e.tab}},{key:"render",value:function(){var e={};return e[this.props.tab]="on",u.a.createElement("nav",{className:"index-nav"},u.a.createElement("ul",null,u.a.createElement("li",{className:e.all},u.a.createElement(f.a,{to:"/"},"全部")),u.a.createElement("li",{className:e.good},u.a.createElement(f.a,{to:"/?tab=good"},"精华")),u.a.createElement("li",{className:e.share},u.a.createElement(f.a,{to:"/?tab=share"},"分享")),u.a.createElement("li",{className:e.ask},u.a.createElement(f.a,{to:"/?tab=ask"},"问答")),u.a.createElement("li",{className:e.job},u.a.createElement(f.a,{to:"/?tab=job"},"招聘"))),u.a.createElement("div",{className:"height"}))}}]),t}(s.Component);le.propTypes={tab:ie.a.string.isRequired};var ce={};ce.formatDate=function(e){var t=new Date(e),n=(new Date).getTime()-t.getTime();return n<0?"":n/1e3<60?parseInt(n/1e3)+"秒前":n/6e4<60?parseInt(n/6e4)+"分钟前":n/36e5<24?parseInt(n/36e5)+"小时前":n/864e5<31?parseInt(n/864e5)+"天前":n/2592e6<12?parseInt(n/2592e6)+"月前":parseInt(n/31536e6)+"年前"},ce.localItem=function(e,t){return 1==arguments.length?localStorage.getItem(e):localStorage.setItem(e,t)},ce.removeLocalItem=function(e){return e?localStorage.removeItem(e):localStorage.removeItem()},ce.reachBottom=function(){return e=0,document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),(e+(document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight)))/Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)>=.98;var e};n("M+RY");var se=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.loadingData,n=e.loadFailed,a=e.msg;return u.a.createElement("div",null,u.a.createElement("div",{className:"data-load data-load-"+t}),u.a.createElement("p",{className:"data-tips-"+n},a))}}]),t}(s.Component);se.propTypes={loadingData:ie.a.bool,loadFailed:ie.a.bool,msg:ie.a.string};var ue=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.tab,n=e.top,a=e.good;return n?t="top":a&&(t="good"),u.a.createElement("i",{className:"iconfont icon-"+t})}}]),t}(s.Component);ue.propTypes={tab:ie.a.string,top:ie.a.bool,good:ie.a.bool};var me=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){return u.a.createElement("div",{className:"tip-msg-signin"},"你还未登录，请先",u.a.createElement(f.a,{to:"/login"},"登录"))}}]),t}(s.Component),pe=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props.url;return u.a.createElement("div",{className:"user-headimg",style:{backgroundImage:"url("+e+")"}})}}]),t}(s.Component);pe.propTypes={url:ie.a.string};var de=function(e){function t(){var e,n,a,r;C()(this,t);for(var o=arguments.length,i=Array(o),l=0;l<o;l++)i[l]=arguments[l];return n=a=R()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(i))),a.goback=function(){history.go(-1)},r=n,R()(a,r)}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.title,n=e.leftTo,a=e.leftIcon,r=e.rightTo,o=e.rightIcon,i=e.rightClick,l=null;n&&a?l=u.a.createElement(f.a,{to:n},u.a.createElement("i",{className:"iconfont icon-"+a})):"fanhui"===a&&(l=u.a.createElement("a",{onClick:this.goback},u.a.createElement("i",{className:"iconfont icon-"+a})));var c=null;return r&&o?c=u.a.createElement(f.a,{to:r},u.a.createElement("i",{className:"iconfont icon-"+o})):i&&o&&(c=u.a.createElement("div",{onClick:i},u.a.createElement("i",{className:"iconfont icon-"+o}))),u.a.createElement("header",{className:"common-header"},u.a.createElement("div",{className:"icon"},l),u.a.createElement("h2",{className:"title"},t),u.a.createElement("div",{className:"icon"},c))}}]),t}(s.Component);de.contextTypes={router:ie.a.object.isRequired};var fe=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=JSON.parse(ce.localItem("User")),t=e&&e.loginname?"/user/"+e.loginname:"/login",n=[];return n[this.props.index]="on",u.a.createElement("footer",{className:"common-footer"},u.a.createElement("div",{className:"zhanwei"}),u.a.createElement("ul",{className:"menu"},u.a.createElement("li",{className:n[0]},u.a.createElement(f.a,{to:"/"},u.a.createElement("i",{className:"iconfont icon-shouye"}),"首页")),u.a.createElement("li",{className:n[1]},u.a.createElement(f.a,{to:"/topic/create"},u.a.createElement("i",{className:"iconfont icon-fabu"}),"发表")),u.a.createElement("li",{className:n[2]},u.a.createElement(f.a,{to:"/my/messages"},u.a.createElement("i",{className:"iconfont icon-xiaoxi"}),"消息")),u.a.createElement("li",{className:n[3]},u.a.createElement(f.a,{to:t},u.a.createElement("i",{className:"iconfont icon-wode"}),"我的"))))}},{key:"shouldComponentUpdate",value:function(e){return this.props.index!==e.index}}]),t}(s.Component);fe.propTypes={index:ie.a.string},fe.defaultProps={index:0};var he=n("Dd8w"),ve=n.n(he),ge=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.title,a=e.author,r=e.visit_count,o=e.reply_count,i=e.create_at,l=e.last_reply_at;return u.a.createElement("li",null,u.a.createElement(f.a,{to:"/topic/"+t},u.a.createElement("div",{className:"list-title"},u.a.createElement("div",{className:"font"},u.a.createElement(ue,this.props)),u.a.createElement("h3",{className:"tit"},n)),u.a.createElement("div",{className:"bottom"},u.a.createElement("div",{className:"author"},u.a.createElement(pe,{url:a.avatar_url})),u.a.createElement("div",{className:"con"},u.a.createElement("p",{className:"bottom-tip"},u.a.createElement("span",{className:"name"},a.loginname),u.a.createElement("span",{className:"count"},o,"/",r)),u.a.createElement("p",{className:"bottom-tip"},u.a.createElement("time",{className:"create"},ce.formatDate(i)),u.a.createElement("time",{className:"re"},ce.formatDate(l)))))))}},{key:"shouldComponentUpdate",value:function(e){return!1}}]),t}(s.Component);ge.propTypes={id:ie.a.string.isRequired,title:ie.a.string.isRequired,author:ie.a.object.isRequired,visit_count:ie.a.number.isRequired,reply_count:ie.a.number.isRequired,create_at:ie.a.string.isRequired,last_reply_at:ie.a.string.isRequired};n("DKm7");var Ee=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props.list;return u.a.createElement("ul",{className:"index-list"},e.map(function(e,t){return u.a.createElement(ge,ve()({key:e.id},e))}))}}]),t}(s.Component);Ee.propTypes={list:ie.a.array.isRequired};var ye=function(e){function t(e,n){C()(this,t);var a=R()(this,(t.__proto__||x()(t)).call(this,e,n));return a.initPath(e),a.handleScroll=a.handleScroll.bind(a),a}return U()(t,e),S()(t,[{key:"initPath",value:function(e){var t=e.location,n=t.pathname,a=t.search;this.path=n+a}},{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.handleScroll);var e=this.props.pagination;0===e.page?this.loadData():window.scrollTo(e.scrollX,e.scrollY)}},{key:"handleScroll",value:function(){ce.reachBottom()&&(this.props.loadState||this.loadData())}},{key:"loadData",value:function(e,t){var n,a=this.props,r=a.actions,o=a.pagination,i="";i=(this.props.location.search||"all").replace(/\?tab=/,""),n=t||o.page+1,r.getIndexList(n,o.limit,i).then(function(e){e&&r.setCurrPage(n)})}},{key:"componentWillReceiveProps",value:function(e){var t=e.location,n=t.pathname+t.search;this.path!==n&&(this.changeTab(),this.loadData(e,1)),this.initPath(e)}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"changeTab",value:function(){this.props.actions.clearIndexList()}},{key:"componentWillUnmount",value:function(){this.props.actions.setScrollPos({scrollX:window.scrollX,scrollY:window.scrollY}),window.removeEventListener("scroll",this.handleScroll)}},{key:"render",value:function(){var e=(this.props.location.search||"all").replace(/\?tab=/,""),t=this.props,n=t.list,a=t.loadState,r=t.loadFailed,o=t.msg;return u.a.createElement("div",null,u.a.createElement(le,{tab:e}),u.a.createElement(Ee,{list:n}),u.a.createElement(se,{loadingData:a,loadFailed:r,msg:o}),u.a.createElement(fe,{index:"0"}))}}]),t}(s.Component),_e=Object(h.b)(function(e){return{list:e.list.indexList,pagination:e.pagination.pagination,loadState:e.load.loadState,loadFailed:e.load.loadFailed,msg:e.load.msg}},function(e){return{actions:Object(L.b)(N()({},a,r),e)}})(ye);ye.contextTypes={router:ie.a.object};var be=n("mvHQ"),ke=n.n(be);function Ne(e){return function(t,n){return $(t,{method:"post",url:j+"/api/v1/accesstoken/",needLoad:!1,data:{accesstoken:e},success:function(t){var n;t.data.accesstoken=e,n=t.data,ce.localItem("User",ke()(n)),alert("登录成功")},error:function(e){alert(e.data.error_msg)}})}}n("0WpZ");var Ie=function(e){function t(e){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e))}return U()(t,e),S()(t,[{key:"handleClick",value:function(e){var t=this.props.loginClick,n=this.refs.accesstoken.value;return n?(t(n),null):alert("accesstoken不能为空")}},{key:"render",value:function(){var e=this,t=this.props.btnName;return u.a.createElement("div",{className:"signin"},u.a.createElement("div",{className:"center"},u.a.createElement("div",{className:"text"},u.a.createElement("input",{ref:"accesstoken",type:"text",placeholder:"Access Token"})),u.a.createElement("button",{className:"btn",onClick:function(t){return e.handleClick(t)}},t)))}}]),t}(s.Component);Ie.propTypes={btnName:ie.a.string.isRequired,loginClick:ie.a.func.isRequired};var xe=function(e){function t(e,n){C()(this,t);var a=R()(this,(t.__proto__||x()(t)).call(this,e,n));return a.state={button:"登录"},a}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){}},{key:"handleLogin",value:function(e){var t=this,n=this.props.actions;this.setState({button:"登录中..."}),n.login(e).then(function(e){e?t.props.history.push("/user/"+JSON.parse(ce.localItem("User")).loginname):t.setState({button:"登录"})})}},{key:"render",value:function(){var e=this;return u.a.createElement("div",null,u.a.createElement(de,{title:"登录",leftIcon:"fanhui"}),u.a.createElement(Ie,{btnName:this.state.button,loginClick:function(t){return e.handleLogin(t)}}))}}]),t}(s.Component),Te=Object(h.b)(function(e){return{}},function(e){return{actions:Object(L.b)(N()({},o),e)}})(xe);xe.contextTypes={router:ie.a.object};n("0mzG");var Ce=function(e){function t(e){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e))}return U()(t,e),S()(t,[{key:"loginOut",value:function(){var e=this.props.loginOut;e()}},{key:"render",value:function(){var e=this;return u.a.createElement("div",{className:"signin","data-flex":"dir:top main:center cross:center"},u.a.createElement("div",{className:"center"},u.a.createElement("button",{className:"btn btn-red",onClick:function(){return e.loginOut()}},"确认退出登录？")))}}]),t}(s.Component);Ce.propTypes={loginOut:ie.a.func.isRequired};var we=function(e){function t(e,n){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e,n))}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){}},{key:"handleLoginout",value:function(){ce.removeLocalItem("User"),this.props.history.push("/")}},{key:"render",value:function(){var e=this;return u.a.createElement("div",null,u.a.createElement(de,{title:"退出登录",leftIcon:"fanhui"}),u.a.createElement(Ce,{loginOut:function(){return e.handleLoginout()}}))}}]),t}(s.Component),Se=Object(h.b)(function(e){return{}},function(e){return{dispatch:e}})(we);function De(e){return function(t,n){return $(t,{method:"get",url:j+"/api/v1/messages?accesstoken="+e,success:function(e){var n=e.data.data.has_read_messages.concat(e.data.data.hasnot_read_messages);t(Re(n))},error:function(e){alert(e.data.error_msg)}})}}function Re(e){return{type:H,data:e}}we.contextTypes={router:ie.a.object};n("4NBI");var Oe=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props.list;return u.a.createElement("div",{className:"msg-box"},u.a.createElement("ul",{className:"list"},e.map(function(e,t){var n=e.type,a=e.author,r=e.topic,o=e.reply,i=e.has_read,l=null;return l="at"==n?u.a.createElement("div",null,"在话题",u.a.createElement(f.a,{to:"/topic/"+r.id},r.title),"中 @了你"):u.a.createElement("div",null,"回复你了的话题",u.a.createElement(f.a,{to:"/topic/"+r.id},r.title)),u.a.createElement("li",{key:t},u.a.createElement(f.a,{className:"user",to:"/user/"+a.loginname},u.a.createElement(pe,{url:a.avatar_url})),u.a.createElement("div",{className:"message-content"},u.a.createElement("div",{className:"name"},a.loginname,u.a.createElement("time",null,ce.formatDate(o.create_at))),u.a.createElement("div",null,u.a.createElement("div",null,u.a.createElement("div",{className:"dian-"+i})),l)))})))}}]),t}(s.Component);Oe.propTypes={list:ie.a.array.isRequired};var Ue=function(e){function t(e,n){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e,n))}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){var e=this.props.actions,t=JSON.parse(ce.localItem("User"));t&&e.getUserInfo(t.accesstoken).then(function(e){}),e.clearIndexList(),e.setCurrPage(0)}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.loadState,a=e.loadFailed,r=e.msg,o=null;return o=JSON.parse(ce.localItem("User"))?t?u.a.createElement(Oe,{list:t}):u.a.createElement(se,{loadingData:n,loadFailed:a,msg:r}):u.a.createElement(me,null),u.a.createElement("div",null,u.a.createElement(de,{title:"消息"}),o,u.a.createElement(fe,{index:"2"}))}}]),t}(s.Component),Le=Object(h.b)(function(e){return{data:e.messages.messages,loadState:e.load.loadState,loadFailed:e.load.loadFailed,msg:e.load.msg}},function(e){return{actions:Object(L.b)(N()({},i,a,r),e)}})(Ue);function je(e){return function(t,n){return $(t,{method:"get",url:j+"/api/v1/topic/"+e,success:function(e){t(Pe(e.data.data))},error:function(e){alert(e.data.error_msg)}})}}function Pe(e){return{type:q,data:e}}function Fe(e){return{type:A,data:e}}function We(e,t,n,a){return function(r,o){return $(r,{method:"post",url:j+"/api/v1/reply/"+e+"/ups",needLoad:!1,data:{accesstoken:t},success:function(e){r(Me({action:e.data.action,uid:a,index:n}))},error:function(e){alert(e.data.error_msg)}})}}function Me(e){return{type:B,data:e}}function Ze(e){return function(t,n){return $(t,{method:"post",url:j+"/api/v1/topic/"+e.id+"/replies",data:{accesstoken:e.accesstoken,"reply_id ":e.reply_id,content:e.content},needLoad:!1,success:function(e){alert("回复成功")},error:function(e){alert(e.data.error_msg)}})}}function qe(e){return function(t,n){return $(t,{method:"post",url:j+"/api/v1/topics",data:e,needLoad:!1,success:function(e){},error:function(e){alert(e.data.error_msg)}})}}Ue.contextTypes={router:ie.a.object};var Ae=function(e){function t(e){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e))}return U()(t,e),S()(t,[{key:"handleClick",value:function(e){var t=this.props,n=t.data,a=t.loginname,r=t.submit;if(n.reply_id?n.content="[@"+a+"](/user/"+a+") "+this.refs.content.value:n.content=this.refs.content.value,""==n.content)return alert("回复内容不能为空！");r(n)}},{key:"render",value:function(){var e=this,t=this.props,n=t.display,a=t.placeholder;return u.a.createElement("div",{className:"reply-box",style:{display:n}},u.a.createElement("div",{className:"text"},u.a.createElement("textarea",{ref:"content",placeholder:a})),u.a.createElement("div",{className:"reply-btn"},u.a.createElement("button",{className:"btn",onClick:function(t){return e.handleClick(t)}},"回复")))}}]),t}(s.Component);Ae.propTypes={display:ie.a.string,placeholder:ie.a.string,loginname:ie.a.string,data:ie.a.object,submit:ie.a.func},Ae.contextTypes={router:ie.a.object};var Be=function(e){function t(e){C()(this,t);var n=R()(this,(t.__proto__||x()(t)).call(this,e));return n.isUp=function(e){for(var t=n.props.User,a=t?t.id:"",r=0;r<e.length;r++)if(e[r]===a)return!0;return!1},n}return U()(t,e),S()(t,[{key:"handleClickZan",value:function(e,t,n){(0,this.props.clickZan)(e,t,n)}},{key:"showReplyBox",value:function(e){var t=this.props.showReplyBox;t(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.User,a=t.list,r=t.submit,o=n?n.accesstoken:"";return u.a.createElement("ul",{className:"re-list"},a.map(function(t,n){var a=t.id,i=t.content,l=t.author,c=t.ups,s=t.create_at,m=t.display;m||(m="none");new Date(s);var p=e.isUp(c);return u.a.createElement("li",{key:n},u.a.createElement("div",{className:"headimg"},u.a.createElement(pe,{url:l.avatar_url})),u.a.createElement("div",{className:"main"},u.a.createElement("div",{className:"top"},u.a.createElement(f.a,{to:"/user/"+l.loginname,className:"name"},l.loginname),u.a.createElement("time",null,ce.formatDate(s)),u.a.createElement("div",{className:"lou"},"#",++n)),u.a.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:i}}),u.a.createElement("div",{className:"bottom"},u.a.createElement("div",{className:"font font-"+p,onClick:function(){return e.handleClickZan(a,n,l.loginname)}},u.a.createElement("i",{className:"iconfont icon-dianzan "}),u.a.createElement("em",null,c.length?c.length:"")),u.a.createElement("div",{className:"font",onClick:function(){return e.showReplyBox(n)}},u.a.createElement("i",{className:"iconfont icon-huifu"}))),u.a.createElement(Ae,{placeholder:"@"+l.loginname,submit:r,display:m,loginname:l.loginname,data:{accesstoken:o,id:e.props.id,reply_id:a}})))}))}}]),t}(s.Component);Be.propTypes={User:ie.a.object,id:ie.a.string,clickZan:ie.a.func,showReplyBox:ie.a.func,list:ie.a.array,submit:ie.a.func};n("Rdbo");var Xe=function(e){function t(e){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.title,a=e.create_at,r=e.visit_count,o=e.reply_count,i=e.content,l=e.replies,c=e.author,s=e.User,m=e.submit,p=e.clickZan,d=e.showReplyBox,h=s?u.a.createElement(Ae,{display:"block",placeholder:"回复支持Markdown语法,请注意标记代码",submit:m,data:{accesstoken:s.accesstoken,id:t}}):u.a.createElement(me,null);return u.a.createElement("div",{className:"topic"},u.a.createElement("div",{className:"user"},u.a.createElement("div",{className:"headimg"},u.a.createElement(pe,{url:c.avatar_url})),u.a.createElement("div",{className:"data"},u.a.createElement("div",null,u.a.createElement(f.a,{to:"/user/"+c.loginname,className:"name"},c.loginname),u.a.createElement("time",{"data-flex-box":"1"},ce.formatDate(a)),u.a.createElement("div",{className:"font"},u.a.createElement(ue,this.props))),u.a.createElement("div",{className:"qt"},u.a.createElement("div",null,"阅读：",r),u.a.createElement("div",null,"回复：",o)))),u.a.createElement("h2",{className:"tit2"},n),u.a.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:i}}),u.a.createElement("h3",{className:"tit3"},"共",u.a.createElement("em",null,l.length),"条回复"),u.a.createElement(Be,{submit:m,id:t,list:l,User:s,clickZan:p,showReplyBox:d}),h)}}]),t}(s.Component);Be.propTypes={id:ie.a.string,title:ie.a.string,create_at:ie.a.string,visit_count:ie.a.number,reply_count:ie.a.number,content:ie.a.string,replies:ie.a.array,author:ie.a.object,User:ie.a.object,clickZan:ie.a.func,showReplyBox:ie.a.func,submit:ie.a.func};var Ye=function(e){function t(e,n){C()(this,t);var a=R()(this,(t.__proto__||x()(t)).call(this,e,n));return a.state={page:{scrollX:0,scrollY:0}},a}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.id;this.loadData(e)}},{key:"loadData",value:function(e,t){var n=this;this.props.actions.getTopicDetail(e).then(function(e){e&&t&&window.scrollTo(n.state.page.scrollX,n.state.page.scrollY)})}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){}},{key:"clickZan",value:function(e,t,n){var a=this.props,r=(a.topicDetail,a.actions),o=JSON.parse(ce.localItem("User")),i=o?o.accesstoken:"",l=o?o.id:"";return i?o.loginname===n?alert("你不能给自己点赞"):void r.setClickZan(e,i,t,l).then(function(e){}):this.props.history.push("/login")}},{key:"showReplyBox",value:function(e){var t=this.props,n=t.topicDetail,a=t.actions,r=JSON.parse(ce.localItem("User"));if(!(r?r.accesstoken:""))return this.props.history.push("/login");--e,"block"===n.replies[e].display?a.setReplybox({index:e,display:"none"}):a.setReplybox({index:e,display:"block"})}},{key:"submit",value:function(e){var t=this,n=this.props;n.dispatch;n.actions.submitReply(e).then(function(n){n&&(t.setState({page:{scrollX:window.scrollX,scrollY:window.scrollY}}),t.loadData(e.id,!0))})}},{key:"render",value:function(){var e=this,t=this.props,n=t.topicDetail,a=t.loadState,r=t.loadFailed,o=t.msg,i=JSON.parse(ce.localItem("User")),l=a||r?u.a.createElement(se,{loadingData:a,loadFailed:r,msg:o}):u.a.createElement(Xe,ve()({},n,{User:i,clickZan:function(t,n,a){return e.clickZan(t,n,a)},showReplyBox:function(t){return e.showReplyBox(t)},submit:function(t){return e.submit(t)}}));return u.a.createElement("div",null,u.a.createElement(de,{title:"详情",leftIcon:"fanhui"}),l)}}]),t}(s.Component),Je=Object(h.b)(function(e){return{topicDetail:e.topicDetail.topicDetail,loadState:e.load.loadState,loadFailed:e.load.loadFailed,msg:e.load.msg}},function(e){return{actions:Object(L.b)(N()({},l),e)}})(Ye);Ye.contextTypes={router:ie.a.object};n("QTQR");var He=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.tab,n=e.title,a=e.content,r=e.tabInput,o=e.titleInput,i=e.contentInput;return u.a.createElement("div",{className:"topic-create"},u.a.createElement("div",{className:"item"},u.a.createElement("select",{name:"tab",defaultValue:t,onInput:r},u.a.createElement("option",{value:""},"请选择发表类型"),u.a.createElement("option",{value:"share"},"分享"),u.a.createElement("option",{value:"ask"},"问答"),u.a.createElement("option",{value:"job"},"招聘"))),u.a.createElement("div",{className:"item"},u.a.createElement("input",{type:"text",defaultValue:n,onInput:o,placeholder:"标题字数 10 字以上"})),u.a.createElement("div",{className:"item"},u.a.createElement("textarea",{defaultValue:a,onInput:i,placeholder:"内容字数 30 字以上"})))}}]),t}(s.Component);He.propTypes={tabInput:ie.a.func,titleInput:ie.a.func,contentInput:ie.a.func};var ze=function(e){function t(e,n){C()(this,t);var a=R()(this,(t.__proto__||x()(t)).call(this,e,n));return a.state={title:"",tab:"",content:"",accesstoken:""},a.tabInput=function(e){a.state.tab=e.target.value},a.titleInput=function(e){a.state.title=e.target.value},a.contentInput=function(e){a.state.content=e.target.value},a.rightClick=function(){var e=a.props.actions;if(!a.state.tab)return alert("请选择发表类型");if(a.state.title.length<10)return alert("标题字数10字以上");if(a.state.content.length<30)return alert("内容字数30字以上");var t=JSON.parse(ce.localItem("User"));a.state.accesstoken=t.accesstoken,e.createTopic(a.state).then(function(e){e&&a.props.history.push("/topic/"+e.data.topic_id)})},a}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){var e=this.props.actions;e.clearIndexList(),e.setCurrPage(0)}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e={},t=null;return JSON.parse(ce.localItem("User"))?(t=u.a.createElement(He,ve()({},this.state,{tabInput:this.tabInput,titleInput:this.titleInput,contentInput:this.contentInput})),e={rightIcon:"fabu",rightClick:this.rightClick}):t=u.a.createElement(me,null),u.a.createElement("div",null,u.a.createElement(de,ve()({title:"发表主题"},e)),t,u.a.createElement(fe,{index:"1"}))}}]),t}(s.Component),Ge=Object(h.b)(function(e){return{}},function(e){return{actions:Object(L.b)(N()({},l,a,r),e)}})(ze);function Ke(e){return function(t,n){return $(t,{method:"get",url:j+"/api/v1/user/"+e,success:function(e){t(Qe(e.data.data))},error:function(e){alert(e.data.error_msg)}})}}function Qe(e){return{type:J,data:e}}ze.contextTypes={router:ie.a.object};var Ve=function(e){function t(){return C()(this,t),R()(this,(t.__proto__||x()(t)).apply(this,arguments))}return U()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.list,n=e.display;return u.a.createElement("ul",{className:"list",style:{display:n}},t.map(function(e,t){var n=e.id,a=e.title,r=e.last_reply_at;return u.a.createElement("li",{key:t},u.a.createElement(f.a,{to:"/topic/"+n},u.a.createElement("div",{className:"tit"},a),u.a.createElement("time",{className:!0},ce.formatDate(r))))}))}}]),t}(s.Component);Ve.propTypes={display:ie.a.string,list:ie.a.array};n("kioz");var $e=function(e){function t(){var e,n,a,r;C()(this,t);for(var o=arguments.length,i=Array(o),l=0;l<o;l++)i[l]=arguments[l];return n=a=R()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(i))),a.state={tabIndex:0},r=n,R()(a,r)}return U()(t,e),S()(t,[{key:"changeTab",value:function(e){this.state.tabIndex!==e&&this.setState({tabIndex:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.avatar_url,a=t.loginname,r=t.score,o=t.recent_topics,i=t.recent_replies,l=t.create_at,c=this.state.tabIndex,s=[],m=[];return s[c]="on",m[c]="block",u.a.createElement("div",{className:"user-index"},u.a.createElement("div",{className:"headimg"},u.a.createElement(pe,{url:n}),u.a.createElement("div",{className:"name"},a),u.a.createElement("div",{className:"score"},"积分：",r,"      注册于：",ce.formatDate(l))),u.a.createElement("ul",{className:"tab-nav"},u.a.createElement("li",{onClick:function(){return e.changeTab(0)},className:s[0]},"主题"),u.a.createElement("li",{onClick:function(){return e.changeTab(1)},className:s[1]},"回复")),u.a.createElement(Ve,{list:o,display:m[0]}),u.a.createElement(Ve,{list:i,display:m[1]}))}}]),t}(s.Component);$e.propTypes={avatar_url:ie.a.string,loginname:ie.a.string,score:ie.a.number,recent_topics:ie.a.array,recent_replies:ie.a.array,create_at:ie.a.string};var et=function(e){function t(e,n){return C()(this,t),R()(this,(t.__proto__||x()(t)).call(this,e,n))}return U()(t,e),S()(t,[{key:"componentDidMount",value:function(){var e=this.props.actions,t=this.props.match.params.loginname;e.getUserInfo(t).then(function(e){}),e.clearIndexList(),e.setCurrPage(0)}},{key:"componentWillReceiveProps",value:function(e){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.match.params,a=e.loadState,r=e.loadFailed,o=e.msg,i=JSON.parse(ce.localItem("User"));i=i||{};var l=a||r?u.a.createElement(se,{loadingData:a,loadFailed:r,msg:o}):u.a.createElement($e,t),c=n.loginname==i.loginname?"个人中心":n.loginname+"的个人中心",s=n.loginname==i.loginname?u.a.createElement(fe,{index:"3"}):null,m=n.loginname==i.loginname?null:"fanhui",p=n.loginname==i.loginname?"tuichu":null;return u.a.createElement("div",null,u.a.createElement(de,{title:c,leftIcon:m,rightIcon:p,rightTo:"/loginout"}),l,s)}}]),t}(s.Component),tt=Object(h.b)(function(e){return{data:e.user.userInfo,loadState:e.load.loadState,loadFailed:e.load.loadFailed,msg:e.load.msg}},function(e){return{actions:Object(L.b)(N()({},c,a,r),e)}})(et);et.contextTypes={router:ie.a.object};var nt=n("bEzl"),at=n("Gu7T"),rt=n.n(at),ot={indexList:[]},it={loadState:!1,loadFailed:!1,msg:""},lt={topicDetail:{author:{},replies:[]}},ct={pagination:{page:0,limit:10,scrollX:0,scrollY:0}},st={userInfo:{recent_topics:[],recent_replies:[]}},ut={messages:[]},mt={list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ot,t=arguments[1];switch(t.type){case P:return N()({},e,{indexList:[].concat(rt()(e.indexList),rt()(t.data))});case F:return N()({},e,{indexList:[]});default:return e}},topicDetail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lt,t=arguments[1];switch(t.type){case q:return N()({},e,{topicDetail:t.data});case A:return N()({},e,{topicDetail:ve()({},e.topicDetail,{replies:e.topicDetail.replies.map(function(e,n){return n===t.data.index?ve()({},e,{display:t.data.display}):e})})});case B:return N()({},e,{topicDetail:ve()({},e.topicDetail,{replies:e.topicDetail.replies.map(function(n,a){if(a===t.data.index-1){var r=e.topicDetail.replies[a].ups,o=t.data.uid;if("down"===t.data.action)for(var i=0;i<r.length;i++)r[i]===o&&r.splice(i,1);else r.push(o);return ve()({},n,{ups:r})}return n})})});default:return e}},pagination:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ct,t=arguments[1];switch(t.type){case X:return N()({},e,{pagination:ve()({},e.pagination,{page:t.data})});case Y:return N()({},e,{pagination:ve()({},e.pagination,{scrollX:t.data.scrollX,scrollY:t.data.scrollY})});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:st,t=arguments[1];switch(t.type){case J:return N()({},e,{userInfo:t.data});default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ut,t=arguments[1];switch(t.type){case H:return N()({},e,{messages:t.data});default:return e}},load:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it,t=arguments[1];switch(t.type){case W:return N()({},e,ve()({},e,{loadState:t.data}));case M:return N()({},e,ve()({},e,{loadFailed:t.data}));case Z:return N()({},e,ve()({},e,{msg:t.data}));default:return e}}},pt=Object(L.c)(ve()({},mt)),dt=(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||L.d,void 0);dt=Object(L.a)(nt.a);n("xKbP"),n("N/eG"),n("lf9d");y.a.locale("zh-cn");var ft,ht=Object(L.e)(pt,ft,dt),vt=b()();var gt=function(){return u.a.createElement(d.a,{locale:g.a},u.a.createElement(h.a,{store:ht},u.a.createElement(f.c,{history:vt},u.a.createElement(f.d,null,u.a.createElement(f.b,{path:"/topic/create",component:Ge}),u.a.createElement(f.b,{path:"/topic/:id",component:Je}),u.a.createElement(f.b,{path:"/login",component:Te}),u.a.createElement(f.b,{path:"/loginout",component:Se}),u.a.createElement(f.b,{path:"/user/:loginname",component:tt}),u.a.createElement(f.b,{path:"/my/messages",component:Le}),u.a.createElement(f.b,{component:_e})))))},Et=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function yt(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}p.a.render(u.a.createElement(gt,null),document.getElementById("app")),new URL("/pwa-demo/",window.location).origin===window.location.origin&&window.addEventListener("load",function(){var e="/pwa-demo//service-worker.js";Et?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):yt(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):yt(e)})},lf9d:function(e,t){},xKbP:function(e,t){}},["lVK7"]);
//# sourceMappingURL=app.1.0.0.1261c0fdb1a07c64df1a.js.map